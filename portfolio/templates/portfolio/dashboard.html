{% extends 'portfolio/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Welcome, {{ user.username }}</h1>
    <p>Your Portfolio Overview</p>
</div>

<!-- Action Buttons -->
<div class="dashboard-actions">
    <a href="{% url 'portfolio:add_holding' %}" class="btn-action">‚ûï Add Holding</a>
    <a href="{% url 'portfolio:export_excel' %}" class="btn-action">üìä Export Excel</a>
    <form method="post" action="{% url 'portfolio:logout' %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn-action logout">üö™ Logout</button>
    </form>
</div>

<!-- Stats Cards -->
<div class="cards-container">
    <div class="card">
        <h3>Total Investment</h3>
        <p class="value">${{ total_investment|floatformat:2 }}</p>
    </div>
    <div class="card">
        <h3>Current Value</h3>
        <p class="value">${{ total_value|floatformat:2 }}</p>
    </div>
    <div class="card">
        <h3>Total Profit / Loss</h3>
        <p class="value {% if total_profit >= 0 %}profit{% else %}loss{% endif %}">
            ${{ total_profit|floatformat:2 }}
        </p>
    </div>
</div>

<!-- Portfolio Trend Chart -->
<div class="card chart-card">
    <h3>üìà Portfolio Trend</h3>
    {% if chart %}
        <img src="data:image/png;base64,{{ chart }}" alt="Portfolio Chart" class="responsive-chart">
    {% else %}
        <p>No data to display chart yet.</p>
    {% endif %}
</div>

<!-- Holdings Table -->
<div class="holdings-section">
    <h2>üìå My Holdings</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Stock</th>
                    <th>Quantity</th>
                    <th>Buy Price</th>
                    <th>Current Price</th>
                    <th>Profit/Loss</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for h in holdings %}
                <tr>
                    <td>{{ h.stock_symbol }}</td>
                    <td>{{ h.quantity }}</td>
                    <td>${{ h.purchase_price|floatformat:2 }}</td>
                    <td>${{ h.current_price|floatformat:2 }}</td>
                    <td class="{% if h.is_profit %}profit{% else %}loss{% endif %}">
                        ${{ h.profit_loss|floatformat:2 }}
                    </td>
                    <td>
                        <a href="{% url 'portfolio:edit_holding' h.id %}" class="action-link">‚úèÔ∏è Edit</a> |
                        <form action="{% url 'portfolio:delete_holding' h.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-link delete" onclick="return confirm('Are you sure you want to delete this holding?');">
                                üóëÔ∏è Delete
                            </button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">No holdings yet. Add your first investment!</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

















